<div class="modal-backdrop" *ngIf="show">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Ajustar Estoque</h2>
            <button class="text-gray-600 hover:text-gray-900 bg-transparent border-none shadow-none outline-none" 
                    (click)="cancelar()" style="background: none;">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        
        <!-- Informações do Produto -->
        <div class="bg-gray-50 p-4 rounded-md mb-4" *ngIf="produto">
            <h3 class="font-medium text-gray-900 mb-2">{{ produto.nome }}</h3>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="text-gray-600">Estoque Atual:</span>
                    <span class="ml-2 font-medium" 
                          [ngClass]="{'text-red-600': produto.estoque <= 0, 'text-green-600': produto.estoque > 0}">
                        {{ produto.estoque }}
                    </span>
                </div>
                <div>
                    <span class="text-gray-600">Unidade:</span>
                    <span class="ml-2 font-medium">{{ produto.unidadeMedida}}</span>
                </div>
            </div>
        </div>
        
        <form (ngSubmit)="onSubmit()" [formGroup]="form" #estoqueForm="ngForm" class="space-y-4" validate>
            <!-- Campo de Ajuste -->
            <div class="flex flex-col">
                <label for="ajuste">Quantidade de Ajuste</label>
                <input type="number" 
                       id="ajuste" 
                       formControlName="ajuste" 
                       name="ajuste"
                       step="0.01"
                       placeholder="Digite um valor positivo ou negativo"
                       class="mt-2 border border-gray-300 rounded-md px-3 py-2"
                       [ngClass]="{'bg-red-50 border-l-4 border-l-red-500 focus:bg-red-25 focus:outline-red-500': hasFieldError('ajuste', 'required')}"
                       required>
                <small class="text-gray-500 mt-1">
                    Valores positivos aumentam o estoque, valores negativos diminuem
                </small>
                <small *ngIf="hasFieldError('ajuste', 'required')" class="text-red-500 mt-1">
                    Quantidade de ajuste é obrigatória
                </small>            </div>

            <!-- Preview do Novo Estoque -->
            <div class="bg-blue-50 p-3 rounded-md" *ngIf="form.get('ajuste')?.value !== null && form.get('ajuste')?.value !== 0">
                <div class="flex justify-between items-center">
                    <span class="text-blue-800 font-medium">Novo Estoque:</span>
                    <span class="text-blue-900 font-bold text-lg"
                          [ngClass]="{'text-red-600': calcularNovoEstoque() <= 0, 'text-green-600': calcularNovoEstoque() > 0}">
                        {{ calcularNovoEstoque() }}
                    </span>
                </div>
                <div class="text-sm text-blue-700 mt-1">
                    {{ produto?.estoque || 0 }} 
                    {{ (form.get('ajuste')?.value || 0) >= 0 ? '+' : '' }}{{ form.get('ajuste')?.value || 0 }} 
                    = {{ calcularNovoEstoque() }}
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="flex gap-4 mt-6">
                <button type="submit" 
                        class="p-2 flex-1 bg-blue-500 hover:bg-blue-600 text-white focus:outline-2 
                               focus:outline-offset-2 focus:outline-blue-500 active:bg-blue-700 rounded-md"
                        [disabled]="!form.valid">
                    Confirmar Ajuste
                </button>

                <button type="button" 
                        (click)="cancelar()" 
                        class="p-2 flex-1 bg-red-500 hover:bg-red-600 text-white focus:outline-2 
                               focus:outline-offset-2 focus:outline-red-500 active:bg-red-700 rounded-md">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>
